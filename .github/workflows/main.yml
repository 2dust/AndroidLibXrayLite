name: Deploy Foxx Org

on:
  push:
    branches:
      - master
    paths:
      - libs/server/org/org-foxx/**

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      HOST: redacted.redacted.org
      DATABASE: wb-org-test
      ENDPOINT: /org-api

    steps:
    - uses: actions/checkout@v2

    - name: Install tar
      run: sudo apt-get update && sudo apt-get install -y tar

    - name: Install Foxx CLI
      run: sudo npm i -g foxx-cli

    - name: Add Database
      run: foxx server set arango https://root:"${{ secrets.ARANGO_TEST_PWD }}"@${{ env.HOST }} -D ${{ env.DATABASE }}

    - name: Upload Service
      run: cd libs/server/org/org-foxx && foxx upgrade --server arango ${{ env.ENDPOINT }}
